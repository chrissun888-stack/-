<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>樣書/業務快速紀錄</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; background: #f6f7f9; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
    .card { background: #fff; border-radius: 14px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h1 { font-size: 18px; margin: 0 0 12px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
    label { display: block; font-size: 13px; color: #333; margin: 0 0 6px; }
    input, select, textarea { width: 100%; padding: 11px 12px; border: 1px solid #d8dde6; border-radius: 10px; font-size: 15px; background: #fff; box-sizing: border-box; }
    textarea { min-height: 92px; resize: vertical; }
    .row2 { grid-column: 1 / -1; }
    .actions { display: flex; gap: 10px; margin-top: 14px; }
    button { flex: 1; padding: 12px 14px; border: 0; border-radius: 12px; font-size: 16px; cursor: pointer; }
    .primary { background: #111827; color: #fff; }
    .ghost { background: #eef2f7; color: #111827; }
    .status { margin-top: 12px; font-size: 14px; }
    .ok { color: #0a7a2f; }
    .err { color: #b42318; }
    .hint { color: #6b7280; font-size: 12px; margin-top: 8px; }
    .req { color: #b42318; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>樣書/業務快速紀錄</h1>

      <div class="grid">
        <div>
          <label>客戶名稱 <span class="req">*</span></label>
          <input id="clientName" placeholder="例如：XX 兒童美語" required />
        </div>
        <div>
          <label>聯絡人</label>
          <input id="contactName" placeholder="例如：王主任" />
        </div>

        <div>
          <label>職稱</label>
          <select id="title">
            <option value="">—</option>
            <option>主任</option>
            <option>老師</option>
            <option>負責人/老闆</option>
            <option>行政</option>
            <option>採購</option>
          </select>
        </div>
        <div>
          <label>電話</label>
          <input id="phone" inputmode="tel" placeholder="可留空" />
        </div>

        <div>
          <label>區域</label>
          <select id="area">
            <option value="">—</option>
            <option>台北市</option>
            <option>新北市</option>
            <option>基隆</option>
            <option>桃園</option>
            <option>新竹</option>
            <option>其他</option>
          </select>
        </div>
        <div>
       <label>教材名稱 *</label>
<select id="product" required onchange="toggleOtherProduct()">
  <option value="">請選擇</option>

  <option>1200 Key English Words</option>
  <option>4500 Key English Words</option>
  <option>7200 Key English Words</option>
  <option>Ahead with Starters/Movers/Flyer/FCE</option>
  <option>ALEKS</option>
  <option>Benchmark Advance</option>
  <option>Benchmark Englsih</option>
  <option>Building / Developing / Matering TOEIC Skills</option>
  <option>Business Partner</option>
  <option>Business Survival</option>
  <option>Chatterbox Kids</option>
  <option>Early Listeners</option>
  <option>Early Writers</option>
  <option>Easy First Reading</option>
  <option>Easy Fun Facts</option>
  <option>Easy Fun Reading</option>
  <option>Easy Speaking for Speeches</option>
  <option>English Central</option>
  <option>ELI Board Games: Around The City / Play for Planet</option>
  <option>ELI Liberty Step Reader</option>
  <option>Eli Ready for A2/B1/B2 for School</option>
  <option>English with Games and Activities</option>
  <option>Focus on Grammar</option>
  <option>Fun Facts</option>
  <option>Fun Reading</option>
  <option>Future Jobs Reader</option>
  <option>Good Listeners</option>
  <option>Good Writers</option>
  <option>Grammar Goals</option>
  <option>Guided Reading</option>
  <option>Happy Grammar</option>
  <option>Hide and Seek</option>
  <option>Imagine</option>
  <option>IMPACT (Social Studies)</option>
  <option>Innova</option>
  <option>Inspire Science</option>
  <option>Longman Academic Reading</option>
  <option>Longman Academic Writing</option>
  <option>LOOK</option>
  <option>Look and See</option>
  <option>Market Leader</option>
  <option>Mastering Key English Vocabulary</option>
  <option>My First Steps to Phonics</option>
  <option>My Math</option>
  <option>My Phonics</option>
  <option>Open Court Reading</option>
  <option>Open Day</option>
  <option>OPT/YLPT</option>
  <option>Pathway to Grammar</option>
  <option>Pathways 3/e</option>
  <option>Pathways: Reading 3/e</option>
  <option>Pearson Benchmark / Level</option>
  <option>Pearson English Reader</option>
  <option>PET Buster</option>
  <option>Phonics Fun</option>
  <option>PM Writing</option>
  <option>PM+</option>
  <option>Ready Readers</option>
  <option>Reveal Math</option>
  <option>Richmond Practice Test A2 / B1</option>
  <option>Richmond Reader</option>
  <option>Richmond YLE</option>
  <option>Smart Listeners</option>
  <option>Smart Writers</option>
  <option>Speaking for Speeches 2/e</option>
  <option>SRA Reading Labtory</option>
  <option>Start! /Move! / Fast!</option>
  <option>Success with new TOEIC test</option>
  <option>Sunshine Online ELT</option>
  <option>Target - KET / PET</option>
  <option>The Complete GEPT Practice Test</option>
  <option>The Complete TOEIC practice test</option>
  <option>Timed Reading for Fluency</option>
  <option>Top Kids</option>
  <option>Top Phonics</option>
  <option>Top Phonics Reader</option>
  <option>True Stories silver edition</option>
  <option>Viewpoints</option>
  <option>Working English</option>
  <option>World History Reader</option>
  <option>World Windows</option>
  <option>Writing Success</option>
  <option>Writing Time</option>
  <option>Xreading</option>

  <option value="__other__">其他（自行輸入）</option>
</select>

<div id="otherProductWrap" style="display:none; margin-top:8px;">
  <label>其他教材名稱 *</label>
  <input id="otherProduct" type="text" placeholder="請手動輸入教材名稱" />
</div>



        </div>

        <div>
         <label>級數</label>
<select id="level">
  <option value="">請選擇</option>
  <option>Starter</option>
  <option>1</option>
  <option>2</option>
  <option>3</option>
  <option>4</option>
  <option>5</option>
  <option>6</option>
</select>

        </div>
        <div>
          <label>樣書數量 <span class="req">*</span></label>
          <input id="qty" type="number" min="1" value="1" required />
        </div>

        <div>
          <label>樣書狀態 <span class="req">*</span></label>
          <select id="sampleStatus" required>
            <option value="">請選擇</option>
            <option>借出</option>
            <option>回收</option>
            <option>轉購</option>
            <option>作廢</option>
          </select>
        </div>
        <div>
          <label>目前進度 <span class="req">*</span></label>
          <select id="salesStage" required>
            <option value="">請選擇</option>
            <option>剛提供</option>
            <option>試教中</option>
            <option>評估中</option>
            <option>不考慮</option>
            <option>已成交</option>
          </select>
        </div>

        <div>
          <label>預計回覆日</label>
          <input id="nextFollowUp" type="date" />
        </div>
        <div>
          <label>是否成交</label>
          <select id="dealStatus">
            <option value="">—</option>
            <option>尚未</option>
            <option>是</option>
            <option>否</option>
          </select>
        </div>

        <div class="row2">
       <label>備註方式</label>
<select id="noteType" onchange="toggleNoteType()">
  <option value="text">文字輸入</option>
  <option value="voice">錄音</option>
</select>

<div id="noteTextWrap" style="margin-top:8px;">
  <label>文字備註</label>
  <textarea id="noteText" placeholder="請輸入備註內容"></textarea>
</div>

<div id="noteVoiceWrap" style="display:none; margin-top:8px;">
  <label>語音備註</label>
  <button type="button" onclick="startRecording()">開始錄音</button>
  <button type="button" onclick="stopRecording()">停止</button>
  <audio id="audioPreview" controls style="display:none; margin-top:8px;"></audio>
</div>


        <div>
          <label>紀錄人</label>
          <input id="user" placeholder="例如：阿祥" />
        </div>
        <div>
          <label>來源</label>
          <input id="source" value="HTML" />
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="saveBtn">儲存業務紀錄</button>
        <button class="ghost" id="resetBtn" type="button">清空</button>
      </div>

      <div class="status" id="status"></div>
      <div class="hint">建議把此頁加入手機主畫面，變成一鍵開啟。</div>
    </div>
  </div>

<script>
function toggleOtherProduct() {
  const productSelect = document.getElementById("product");
  const otherWrap = document.getElementById("otherProductWrap");
  const otherInput = document.getElementById("otherProduct");

  if (productSelect.value === "__other__") {
    otherWrap.style.display = "block";
    otherInput.required = true;
  } else {
    otherWrap.style.display = "none";
    otherInput.required = false;
    otherInput.value = "";
  }
}
</script>

  // 只要改這兩個
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyB0QPMnj0PHWSNrvoIoYoQ4xDkfZU9lUnHnAHgh2fP3tGlEmwIZL2DZ3YVSgC5ZwhyAQ/exec";
  const TOKEN = "u-sVlrZ8qnwXbzlGE6S8ecfzW_ftq7Cv";

  const $ = (id) => document.getElementById(id);
  const statusEl = $("status");

  function setStatus(msg, type) {
    statusEl.textContent = msg;
    statusEl.className = "status " + (type || "");
  }

  function getValue(id) { return $(id).value.trim(); }

  function validate() {
    if (!getValue("clientName")) return "請填客戶名稱";
    if (!getValue("product")) return "請選教材名稱";
    const qty = Number(getValue("qty"));
    if (!Number.isFinite(qty) || qty < 1) return "樣書數量需 >= 1";
    if (!getValue("sampleStatus")) return "請選樣書狀態";
    if (!getValue("salesStage")) return "請選目前進度";
    return "";
  }

  async function save() {
    const err = validate();
    if (err) { setStatus(err, "err"); return; }

    const payload = {
      token: TOKEN,
      clientName: getValue("clientName"),
      contactName: getValue("contactName"),
      title: getValue("title"),
      phone: getValue("phone"),
      area: getValue("area"),
      product:
  getValue("product") === "__other__"
    ? getValue("otherProduct")
    : getValue("product"),
      level: getValue("level"),
      qty: getValue("qty"),
      sampleStatus: getValue("sampleStatus"),
      salesStage: getValue("salesStage"),
      nextFollowUp: getValue("nextFollowUp"),
      dealStatus: getValue("dealStatus"),
      note:
  document.getElementById("noteType").value === "voice"
    ? audioBase64
    : document.getElementById("noteText").value.trim(),

      user: getValue("user"),
      source: getValue("source") || "HTML"
    };

    setStatus("儲存中…");

    try {
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      const data = await res.json().catch(() => ({}));

      if (data && data.ok) {
        setStatus("已儲存", "ok");
      } else {
        setStatus("儲存失敗：" + (data.error || "Unknown error"), "err");
      }
    } catch (e) {
      setStatus("連線失敗：" + String(e), "err");
    }
  }

  $("saveBtn").addEventListener("click", (e) => { e.preventDefault(); save(); });
  $("resetBtn").addEventListener("click", () => {
    ["clientName","contactName","title","phone","area","product","level","qty","sampleStatus","salesStage","nextFollowUp","dealStatus","note","user","source"]
      .forEach(id => $(id).value = (id === "qty" ? "1" : (id === "source" ? "HTML" : "")));
    setStatus("");
  });
</script>
</body>
</html>
<script>
let mediaRecorder;
let audioChunks = [];
let audioBase64 = "";

function toggleNoteType() {
  const type = document.getElementById("noteType").value;
  document.getElementById("noteTextWrap").style.display = type === "text" ? "block" : "none";
  document.getElementById("noteVoiceWrap").style.display = type === "voice" ? "block" : "none";
}

async function startRecording() {
  audioChunks = [];
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  mediaRecorder = new MediaRecorder(stream);
  mediaRecorder.start();

  mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
  mediaRecorder.onstop = () => {
    const blob = new Blob(audioChunks, { type: "audio/webm" });
    const audioURL = URL.createObjectURL(blob);
    const audio = document.getElementById("audioPreview");
    audio.src = audioURL;
    audio.style.display = "block";

    const reader = new FileReader();
    reader.onloadend = () => {
      audioBase64 = reader.result; // base64 存文字
    };
    reader.readAsDataURL(blob);
  };
}

function stopRecording() {
  if (mediaRecorder) mediaRecorder.stop();
}
</script>
