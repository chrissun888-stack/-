<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>樣書/業務快速紀錄</title>
  <style>
    body { font-family: system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif; margin: 0; background: #f6f7f9; }
    .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
    .card { background: #fff; border-radius: 14px; padding: 16px; box-shadow: 0 6px 18px rgba(0,0,0,.06); }
    h1 { font-size: 18px; margin: 0 0 12px; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
    label { display: block; font-size: 13px; color: #333; margin: 0 0 6px; }
    input, select, textarea { width: 100%; padding: 11px 12px; border: 1px solid #d8dde6; border-radius: 10px; font-size: 15px; background: #fff; box-sizing: border-box; }
    textarea { min-height: 92px; resize: vertical; }
    .row2 { grid-column: 1 / -1; }
    .actions { display: flex; gap: 10px; margin-top: 14px; }
    button { flex: 1; padding: 12px 14px; border: 0; border-radius: 12px; font-size: 16px; cursor: pointer; }
    .primary { background: #111827; color: #fff; }
    .ghost { background: #eef2f7; color: #111827; }
    .status { margin-top: 12px; font-size: 14px; }
    .ok { color: #0a7a2f; }
    .err { color: #b42318; }
    .hint { color: #6b7280; font-size: 12px; margin-top: 8px; }
    .req { color: #b42318; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>樣書/業務快速紀錄</h1>

      <div class="grid">
        <div>
          <label>客戶名稱 <span class="req">*</span></label>
          <input id="clientName" placeholder="例如：XX 兒童美語" required />
        </div>
        <div>
          <label>聯絡人</label>
          <input id="contactName" placeholder="例如：王主任" />
        </div>

        <div>
          <label>職稱</label>
          <select id="title">
            <option value="">—</option>
            <option>主任</option>
            <option>老師</option>
            <option>負責人/老闆</option>
            <option>行政</option>
            <option>採購</option>
          </select>
        </div>
        <div>
          <label>電話</label>
          <input id="phone" inputmode="tel" placeholder="可留空" />
        </div>

        <div>
          <label>區域</label>
          <select id="area">
            <option value="">—</option>
            <option>台北市</option>
            <option>新北市</option>
            <option>基隆</option>
            <option>桃園</option>
            <option>新竹</option>
            <option>其他</option>
          </select>
        </div>
        <div>
          <label>教材名稱 <span class="req">*</span></label>
          <select id="product" required>
            <option value="">請選擇</option>
            <option>Phonics Monster 3rd</option>
            <option>（其他）</option>
          </select>
        </div>

        <div>
          <label>冊別/級數</label>
          <select id="level">
            <option value="">—</option>
            <option>Starter</option>
            <option>Book 1</option>
            <option>Book 2</option>
            <option>Book 3</option>
            <option>Book 4</option>
            <option>Teacher's Guide</option>
          </select>
        </div>
        <div>
          <label>樣書數量 <span class="req">*</span></label>
          <input id="qty" type="number" min="1" value="1" required />
        </div>

        <div>
          <label>樣書狀態 <span class="req">*</span></label>
          <select id="sampleStatus" required>
            <option value="">請選擇</option>
            <option>借出</option>
            <option>回收</option>
            <option>轉購</option>
            <option>作廢</option>
          </select>
        </div>
        <div>
          <label>目前進度 <span class="req">*</span></label>
          <select id="salesStage" required>
            <option value="">請選擇</option>
            <option>剛提供</option>
            <option>試教中</option>
            <option>評估中</option>
            <option>不考慮</option>
            <option>已成交</option>
          </select>
        </div>

        <div>
          <label>預計回覆日</label>
          <input id="nextFollowUp" type="date" />
        </div>
        <div>
          <label>是否成交</label>
          <select id="dealStatus">
            <option value="">—</option>
            <option>尚未</option>
            <option>是</option>
            <option>否</option>
          </select>
        </div>

        <div class="row2">
          <label>備註</label>
          <textarea id="note" placeholder="例如：下週安排試教；要看教材內容對照表"></textarea>
        </div>

        <div>
          <label>紀錄人</label>
          <input id="user" placeholder="例如：阿祥" />
        </div>
        <div>
          <label>來源</label>
          <input id="source" value="HTML" />
        </div>
      </div>

      <div class="actions">
        <button class="primary" id="saveBtn">儲存業務紀錄</button>
        <button class="ghost" id="resetBtn" type="button">清空</button>
      </div>

      <div class="status" id="status"></div>
      <div class="hint">建議把此頁加入手機主畫面，變成一鍵開啟。</div>
    </div>
  </div>

<script>
  // 只要改這兩個
  const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyB0QPMnj0PHWSNrvoIoYoQ4xDkfZU9lUnHnAHgh2fP3tGlEmwIZL2DZ3YVSgC5ZwhyAQ/exec";
  const TOKEN = "u-sVlrZ8qnwXbzlGE6S8ecfzW_ftq7Cv";

  const $ = (id) => document.getElementById(id);
  const statusEl = $("status");

  function setStatus(msg, type) {
    statusEl.textContent = msg;
    statusEl.className = "status " + (type || "");
  }

  function getValue(id) { return $(id).value.trim(); }

  function validate() {
    if (!getValue("clientName")) return "請填客戶名稱";
    if (!getValue("product")) return "請選教材名稱";
    const qty = Number(getValue("qty"));
    if (!Number.isFinite(qty) || qty < 1) return "樣書數量需 >= 1";
    if (!getValue("sampleStatus")) return "請選樣書狀態";
    if (!getValue("salesStage")) return "請選目前進度";
    return "";
  }

  async function save() {
    const err = validate();
    if (err) { setStatus(err, "err"); return; }

    const payload = {
      token: TOKEN,
      clientName: getValue("clientName"),
      contactName: getValue("contactName"),
      title: getValue("title"),
      phone: getValue("phone"),
      area: getValue("area"),
      product: getValue("product"),
      level: getValue("level"),
      qty: getValue("qty"),
      sampleStatus: getValue("sampleStatus"),
      salesStage: getValue("salesStage"),
      nextFollowUp: getValue("nextFollowUp"),
      dealStatus: getValue("dealStatus"),
      note: $("note").value.trim(),
      user: getValue("user"),
      source: getValue("source") || "HTML"
    };

    setStatus("儲存中…");

    try {
      const res = await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "text/plain;charset=utf-8" },
        body: JSON.stringify(payload)
      });

      const data = await res.json().catch(() => ({}));

      if (data && data.ok) {
        setStatus("已儲存", "ok");
      } else {
        setStatus("儲存失敗：" + (data.error || "Unknown error"), "err");
      }
    } catch (e) {
      setStatus("連線失敗：" + String(e), "err");
    }
  }

  $("saveBtn").addEventListener("click", (e) => { e.preventDefault(); save(); });
  $("resetBtn").addEventListener("click", () => {
    ["clientName","contactName","title","phone","area","product","level","qty","sampleStatus","salesStage","nextFollowUp","dealStatus","note","user","source"]
      .forEach(id => $(id).value = (id === "qty" ? "1" : (id === "source" ? "HTML" : "")));
    setStatus("");
  });
</script>
</body>
</html>
